import { __assign, __rest } from "tslib";
import React, { useImperativeHandle, useRef } from 'react';
import clsx from 'clsx';
import { getBaseProps } from '../internal/base-component';
import { InternalButton } from '../button/internal';
import { AdditionalInfo } from './additional-info';
import { Row } from './row';
import styles from './styles.css.js';
import { useContainerBreakpoints } from '../internal/hooks/container-queries';
import InternalBox from '../box/internal';
import mergeRefs from 'react-merge-refs';
var InternalAttributeEditor = React.forwardRef(function (_a, ref) {
    var additionalInfo = _a.additionalInfo, disableAddButton = _a.disableAddButton, definition = _a.definition, _b = _a.items, items = _b === void 0 ? [] : _b, _c = _a.isItemRemovable, isItemRemovable = _c === void 0 ? function () { return true; } : _c, empty = _a.empty, addButtonText = _a.addButtonText, removeButtonText = _a.removeButtonText, onAddButtonClick = _a.onAddButtonClick, onRemoveButtonClick = _a.onRemoveButtonClick, _d = _a.__internalRootRef, __internalRootRef = _d === void 0 ? null : _d, props = __rest(_a, ["additionalInfo", "disableAddButton", "definition", "items", "isItemRemovable", "empty", "addButtonText", "removeButtonText", "onAddButtonClick", "onRemoveButtonClick", "__internalRootRef"]);
    var _e = useContainerBreakpoints(['default', 'xxs', 'xs']), breakpoint = _e[0], breakpointRef = _e[1];
    var removeButtonRefs = useRef([]);
    var baseProps = getBaseProps(props);
    var isEmpty = items && items.length === 0;
    useImperativeHandle(ref, function () { return ({
        focusRemoveButton: function (rowIndex) {
            var _a;
            (_a = removeButtonRefs.current[rowIndex]) === null || _a === void 0 ? void 0 : _a.focus();
        }
    }); });
    return (React.createElement("div", __assign({}, baseProps, { ref: mergeRefs([breakpointRef, __internalRootRef]), className: clsx(baseProps.className, styles.root) }),
        React.createElement(InternalBox, { margin: { bottom: 'l' } },
            isEmpty && React.createElement("div", { className: styles.empty }, empty),
            items.map(function (item, index) { return (React.createElement(Row, { key: index, index: index, breakpoint: breakpoint, item: item, definition: definition, removable: isItemRemovable(item), removeButtonText: removeButtonText, removeButtonRefs: removeButtonRefs.current, onRemoveButtonClick: onRemoveButtonClick })); })),
        React.createElement(InternalButton, { className: styles['add-button'], disabled: disableAddButton, onClick: onAddButtonClick, formAction: "none" }, addButtonText),
        additionalInfo && React.createElement(AdditionalInfo, null, additionalInfo)));
});
export default InternalAttributeEditor;
