{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { OpenAnnotation } from './annotation/open-annotation';\nimport { ClosedAnnotation } from './annotation/closed-annotation';\nimport { hotspotContext } from './context';\nimport { fireNonCancelableEvent } from '../internal/events';\nimport { useTelemetry } from '../internal/hooks/use-telemetry';\nimport { applyDisplayName } from '../internal/utils/apply-display-name';\nexport function getStepInfo(annotations, index) {\n  if (index >= 0) {\n    var taskIndex = 0;\n\n    for (var _i = 0, annotations_1 = annotations; _i < annotations_1.length; _i++) {\n      var task = annotations_1[_i];\n\n      if (task.steps.length <= index) {\n        index -= task.steps.length;\n        taskIndex++;\n        continue;\n      }\n\n      return {\n        task: task,\n        step: task.steps[index],\n        localIndex: index,\n        taskIndex: taskIndex\n      };\n    }\n  }\n\n  return {\n    task: undefined,\n    step: undefined,\n    localIndex: 0,\n    taskIndex: 0\n  };\n}\nvar emptyTasks = [];\nexport default function AnnotationContext(_a) {\n  var _b, _c, _d, _e;\n\n  var currentTutorial = _a.currentTutorial,\n      children = _a.children,\n      onStepChange = _a.onStepChange,\n      onFinishHandler = _a.onFinish,\n      onStartTutorial = _a.onStartTutorial,\n      onExitTutorial = _a.onExitTutorial,\n      i18nStrings = _a.i18nStrings;\n  useTelemetry('AnnotationContext');\n\n  var _f = useState(true),\n      open = _f[0],\n      setOpen = _f[1];\n\n  var _g = useState(0),\n      currentStepIndex = _g[0],\n      setCurrentStepIndex = _g[1];\n\n  useEffect(function () {\n    setCurrentStepIndex(0);\n    setOpen(true);\n  }, [currentTutorial, setOpen]);\n\n  var _h = useState({}),\n      availableHotspots = _h[0],\n      setAvailableHotspots = _h[1];\n\n  var availableHotspotsRef = useRef(availableHotspots);\n  var annotations = currentTutorial ? currentTutorial.tasks : emptyTasks;\n\n  var _j = getStepInfo(annotations, currentStepIndex),\n      task = _j.task,\n      step = _j.step,\n      localIndex = _j.localIndex,\n      taskIndex = _j.taskIndex;\n\n  var currentId = step === null || step === void 0 ? void 0 : step.hotspotId;\n  var totalStepCount = annotations.map(function (a) {\n    return a.steps.length;\n  }).reduce(function (a, b) {\n    return a + b;\n  }, 0);\n  var id2index = useMemo(function () {\n    var mapping = {};\n    var counter = 0;\n\n    for (var _i = 0, annotations_2 = annotations; _i < annotations_2.length; _i++) {\n      var annotation = annotations_2[_i];\n\n      for (var _a = 0, _b = annotation.steps; _a < _b.length; _a++) {\n        var step_1 = _b[_a];\n\n        if (mapping[step_1.hotspotId] === undefined) {\n          mapping[step_1.hotspotId] = counter;\n        }\n\n        counter++;\n      }\n    }\n\n    return mapping;\n  }, [annotations]);\n  var openNextStep = useCallback(function () {\n    var newStepIndex = Math.min(currentStepIndex + 1, totalStepCount);\n    setCurrentStepIndex(newStepIndex);\n    fireNonCancelableEvent(onStepChange, {\n      step: newStepIndex,\n      reason: 'next'\n    });\n  }, [currentStepIndex, onStepChange, totalStepCount]);\n  var openPreviousStep = useCallback(function () {\n    var newStepIndex = Math.max(currentStepIndex - 1, 0);\n    setCurrentStepIndex(newStepIndex);\n    fireNonCancelableEvent(onStepChange, {\n      step: newStepIndex,\n      reason: 'previous'\n    });\n  }, [onStepChange, currentStepIndex]);\n  var onFinish = useCallback(function () {\n    return fireNonCancelableEvent(onFinishHandler);\n  }, [onFinishHandler]);\n  var isCurrentHotspotAvailable = currentId ? availableHotspots[currentId] : null;\n  useEffect(function () {\n    if (!currentId || availableHotspotsRef.current[currentId]) {\n      return;\n    }\n\n    var findNearestHotspot = function () {\n      var nearestHotspot = undefined;\n      var nearestDistance = Infinity;\n\n      for (var _i = 0, _a = Object.keys(availableHotspotsRef.current); _i < _a.length; _i++) {\n        var hotspotId = _a[_i];\n        var distanceFromCurrentHotspot = Math.abs(id2index[hotspotId] - currentStepIndex);\n\n        if (distanceFromCurrentHotspot < nearestDistance) {\n          nearestDistance = distanceFromCurrentHotspot;\n          nearestHotspot = hotspotId;\n        }\n      }\n\n      return nearestHotspot;\n    };\n\n    var nearestHotspot = findNearestHotspot();\n\n    if (nearestHotspot) {\n      var newStepIndex = id2index[nearestHotspot];\n      setCurrentStepIndex(newStepIndex);\n      setOpen(true);\n      fireNonCancelableEvent(onStepChange, {\n        step: newStepIndex,\n        reason: 'auto-fallback'\n      });\n    }\n  }, [annotations, isCurrentHotspotAvailable, currentId, currentStepIndex, id2index, onStepChange]);\n  var onDismiss = useCallback(function () {\n    setOpen(false);\n  }, [setOpen]);\n  var onOpen = useCallback(function (stepIndex) {\n    setCurrentStepIndex(stepIndex);\n    fireNonCancelableEvent(onStepChange, {\n      step: stepIndex,\n      reason: 'open'\n    });\n    setOpen(true);\n  }, [onStepChange, setOpen]);\n  var idOfPreviousHotspot = (_b = getStepInfo(annotations, currentStepIndex - 1).step) === null || _b === void 0 ? void 0 : _b.hotspotId;\n  var idOfNextHotspot = (_c = getStepInfo(annotations, currentStepIndex + 1).step) === null || _c === void 0 ? void 0 : _c.hotspotId;\n  var previousHotspotIsAvailable = (_d = idOfPreviousHotspot !== undefined && availableHotspots[idOfPreviousHotspot]) !== null && _d !== void 0 ? _d : false;\n  var nextHotspotIsAvailable = (_e = idOfNextHotspot !== undefined && availableHotspots[idOfNextHotspot]) !== null && _e !== void 0 ? _e : false;\n  var getContentForId = useCallback(function (id, direction) {\n    if (currentTutorial === null || currentTutorial === void 0 ? void 0 : currentTutorial.completed) {\n      return null;\n    }\n\n    var globalStepIndex = id2index[id];\n\n    if (globalStepIndex === undefined) {\n      return null;\n    }\n\n    if (!task || !step || !open || id !== currentId) {\n      return React.createElement(ClosedAnnotation, {\n        globalStepIndex: globalStepIndex,\n        i18nStrings: i18nStrings,\n        onOpen: onOpen,\n        focusOnRender: id === currentId\n      });\n    }\n\n    return React.createElement(OpenAnnotation, {\n      i18nStrings: i18nStrings,\n      direction: direction,\n      title: i18nStrings.taskTitle(taskIndex, task.title),\n      content: step.content,\n      alert: step.warningAlert,\n      showPreviousButton: currentStepIndex !== 0,\n      showFinishButton: currentStepIndex + 1 === totalStepCount,\n      taskLocalStepIndex: localIndex,\n      totalLocalSteps: task.steps.length,\n      nextButtonEnabled: nextHotspotIsAvailable,\n      onNextButtonClick: openNextStep,\n      onFinish: onFinish,\n      previousButtonEnabled: previousHotspotIsAvailable,\n      onPreviousButtonClick: openPreviousStep,\n      onDismiss: onDismiss\n    });\n  }, [id2index, currentTutorial, task, step, open, currentId, currentStepIndex, i18nStrings, taskIndex, localIndex, totalStepCount, nextHotspotIsAvailable, openNextStep, onFinish, previousHotspotIsAvailable, openPreviousStep, onDismiss, onOpen]);\n  var registerHotspot = useCallback(function (id) {\n    var _a;\n\n    if (!id2index || id2index[id] === undefined) {\n      return;\n    }\n\n    availableHotspotsRef.current = __assign(__assign({}, availableHotspotsRef.current), (_a = {}, _a[id] = true, _a));\n    setAvailableHotspots(function (availableHotspots) {\n      var _a;\n\n      if (availableHotspots[id]) {\n        return availableHotspots;\n      }\n\n      return __assign(__assign({}, availableHotspots), (_a = {}, _a[id] = true, _a));\n    });\n  }, [id2index]);\n  var unregisterHotspot = useCallback(function (id) {\n    if (!availableHotspotsRef.current[id]) {\n      return;\n    }\n\n    availableHotspotsRef.current = removeKey(id, availableHotspotsRef.current);\n    setAvailableHotspots(function (availableHotspots) {\n      if (!availableHotspots[id]) {\n        return availableHotspots;\n      }\n\n      return removeKey(id, availableHotspots);\n    });\n  }, []);\n  var context = {\n    getContentForId: getContentForId,\n    registerHotspot: registerHotspot,\n    unregisterHotspot: unregisterHotspot,\n    onStartTutorial: onStartTutorial,\n    onExitTutorial: onExitTutorial,\n    currentStepIndex: currentStepIndex,\n    currentTutorial: currentTutorial\n  };\n  return React.createElement(hotspotContext.Provider, {\n    value: context\n  }, children);\n}\napplyDisplayName(AnnotationContext, 'AnnotationContext');\n\nfunction removeKey(key, object) {\n  var _a = object,\n      _b = key,\n      _ = _a[_b],\n      remainingObject = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n\n  return remainingObject;\n}","map":{"version":3,"sources":["/Users/isingheg/Desktop/projects/amazonforvolunteers-ui/node_modules/@awsui/components-react/annotation-context/index.js"],"names":["__assign","__rest","React","useCallback","useEffect","useMemo","useRef","useState","OpenAnnotation","ClosedAnnotation","hotspotContext","fireNonCancelableEvent","useTelemetry","applyDisplayName","getStepInfo","annotations","index","taskIndex","_i","annotations_1","length","task","steps","step","localIndex","undefined","emptyTasks","AnnotationContext","_a","_b","_c","_d","_e","currentTutorial","children","onStepChange","onFinishHandler","onFinish","onStartTutorial","onExitTutorial","i18nStrings","_f","open","setOpen","_g","currentStepIndex","setCurrentStepIndex","_h","availableHotspots","setAvailableHotspots","availableHotspotsRef","tasks","_j","currentId","hotspotId","totalStepCount","map","a","reduce","b","id2index","mapping","counter","annotations_2","annotation","step_1","openNextStep","newStepIndex","Math","min","reason","openPreviousStep","max","isCurrentHotspotAvailable","current","findNearestHotspot","nearestHotspot","nearestDistance","Infinity","Object","keys","distanceFromCurrentHotspot","abs","onDismiss","onOpen","stepIndex","idOfPreviousHotspot","idOfNextHotspot","previousHotspotIsAvailable","nextHotspotIsAvailable","getContentForId","id","direction","completed","globalStepIndex","createElement","focusOnRender","title","taskTitle","content","alert","warningAlert","showPreviousButton","showFinishButton","taskLocalStepIndex","totalLocalSteps","nextButtonEnabled","onNextButtonClick","previousButtonEnabled","onPreviousButtonClick","registerHotspot","unregisterHotspot","removeKey","context","Provider","value","key","object","_","remainingObject"],"mappings":"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","sourcesContent":["import { __assign, __rest } from \"tslib\";\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { OpenAnnotation } from './annotation/open-annotation';\nimport { ClosedAnnotation } from './annotation/closed-annotation';\nimport { hotspotContext } from './context';\nimport { fireNonCancelableEvent } from '../internal/events';\nimport { useTelemetry } from '../internal/hooks/use-telemetry';\nimport { applyDisplayName } from '../internal/utils/apply-display-name';\nexport function getStepInfo(annotations, index) {\n    if (index >= 0) {\n        var taskIndex = 0;\n        for (var _i = 0, annotations_1 = annotations; _i < annotations_1.length; _i++) {\n            var task = annotations_1[_i];\n            if (task.steps.length <= index) {\n                index -= task.steps.length;\n                taskIndex++;\n                continue;\n            }\n            return { task: task, step: task.steps[index], localIndex: index, taskIndex: taskIndex };\n        }\n    }\n    return { task: undefined, step: undefined, localIndex: 0, taskIndex: 0 };\n}\nvar emptyTasks = [];\nexport default function AnnotationContext(_a) {\n    var _b, _c, _d, _e;\n    var currentTutorial = _a.currentTutorial, children = _a.children, onStepChange = _a.onStepChange, onFinishHandler = _a.onFinish, onStartTutorial = _a.onStartTutorial, onExitTutorial = _a.onExitTutorial, i18nStrings = _a.i18nStrings;\n    useTelemetry('AnnotationContext');\n    var _f = useState(true), open = _f[0], setOpen = _f[1];\n    var _g = useState(0), currentStepIndex = _g[0], setCurrentStepIndex = _g[1];\n    useEffect(function () {\n        setCurrentStepIndex(0);\n        setOpen(true);\n    }, [currentTutorial, setOpen]);\n    var _h = useState({}), availableHotspots = _h[0], setAvailableHotspots = _h[1];\n    var availableHotspotsRef = useRef(availableHotspots);\n    var annotations = currentTutorial ? currentTutorial.tasks : emptyTasks;\n    var _j = getStepInfo(annotations, currentStepIndex), task = _j.task, step = _j.step, localIndex = _j.localIndex, taskIndex = _j.taskIndex;\n    var currentId = step === null || step === void 0 ? void 0 : step.hotspotId;\n    var totalStepCount = annotations.map(function (a) { return a.steps.length; }).reduce(function (a, b) { return a + b; }, 0);\n    var id2index = useMemo(function () {\n        var mapping = {};\n        var counter = 0;\n        for (var _i = 0, annotations_2 = annotations; _i < annotations_2.length; _i++) {\n            var annotation = annotations_2[_i];\n            for (var _a = 0, _b = annotation.steps; _a < _b.length; _a++) {\n                var step_1 = _b[_a];\n                if (mapping[step_1.hotspotId] === undefined) {\n                    mapping[step_1.hotspotId] = counter;\n                }\n                counter++;\n            }\n        }\n        return mapping;\n    }, [annotations]);\n    var openNextStep = useCallback(function () {\n        var newStepIndex = Math.min(currentStepIndex + 1, totalStepCount);\n        setCurrentStepIndex(newStepIndex);\n        fireNonCancelableEvent(onStepChange, { step: newStepIndex, reason: 'next' });\n    }, [currentStepIndex, onStepChange, totalStepCount]);\n    var openPreviousStep = useCallback(function () {\n        var newStepIndex = Math.max(currentStepIndex - 1, 0);\n        setCurrentStepIndex(newStepIndex);\n        fireNonCancelableEvent(onStepChange, { step: newStepIndex, reason: 'previous' });\n    }, [onStepChange, currentStepIndex]);\n    var onFinish = useCallback(function () { return fireNonCancelableEvent(onFinishHandler); }, [onFinishHandler]);\n    var isCurrentHotspotAvailable = currentId ? availableHotspots[currentId] : null;\n    useEffect(function () {\n        if (!currentId || availableHotspotsRef.current[currentId]) {\n            return;\n        }\n        var findNearestHotspot = function () {\n            var nearestHotspot = undefined;\n            var nearestDistance = Infinity;\n            for (var _i = 0, _a = Object.keys(availableHotspotsRef.current); _i < _a.length; _i++) {\n                var hotspotId = _a[_i];\n                var distanceFromCurrentHotspot = Math.abs(id2index[hotspotId] - currentStepIndex);\n                if (distanceFromCurrentHotspot < nearestDistance) {\n                    nearestDistance = distanceFromCurrentHotspot;\n                    nearestHotspot = hotspotId;\n                }\n            }\n            return nearestHotspot;\n        };\n        var nearestHotspot = findNearestHotspot();\n        if (nearestHotspot) {\n            var newStepIndex = id2index[nearestHotspot];\n            setCurrentStepIndex(newStepIndex);\n            setOpen(true);\n            fireNonCancelableEvent(onStepChange, { step: newStepIndex, reason: 'auto-fallback' });\n        }\n    }, [annotations, isCurrentHotspotAvailable, currentId, currentStepIndex, id2index, onStepChange]);\n    var onDismiss = useCallback(function () {\n        setOpen(false);\n    }, [setOpen]);\n    var onOpen = useCallback(function (stepIndex) {\n        setCurrentStepIndex(stepIndex);\n        fireNonCancelableEvent(onStepChange, { step: stepIndex, reason: 'open' });\n        setOpen(true);\n    }, [onStepChange, setOpen]);\n    var idOfPreviousHotspot = (_b = getStepInfo(annotations, currentStepIndex - 1).step) === null || _b === void 0 ? void 0 : _b.hotspotId;\n    var idOfNextHotspot = (_c = getStepInfo(annotations, currentStepIndex + 1).step) === null || _c === void 0 ? void 0 : _c.hotspotId;\n    var previousHotspotIsAvailable = (_d = (idOfPreviousHotspot !== undefined && availableHotspots[idOfPreviousHotspot])) !== null && _d !== void 0 ? _d : false;\n    var nextHotspotIsAvailable = (_e = (idOfNextHotspot !== undefined && availableHotspots[idOfNextHotspot])) !== null && _e !== void 0 ? _e : false;\n    var getContentForId = useCallback(function (id, direction) {\n        if (currentTutorial === null || currentTutorial === void 0 ? void 0 : currentTutorial.completed) {\n            return null;\n        }\n        var globalStepIndex = id2index[id];\n        if (globalStepIndex === undefined) {\n            return null;\n        }\n        if (!task || !step || !open || id !== currentId) {\n            return (React.createElement(ClosedAnnotation, { globalStepIndex: globalStepIndex, i18nStrings: i18nStrings, onOpen: onOpen, focusOnRender: id === currentId }));\n        }\n        return (React.createElement(OpenAnnotation, { i18nStrings: i18nStrings, direction: direction, title: i18nStrings.taskTitle(taskIndex, task.title), content: step.content, alert: step.warningAlert, showPreviousButton: currentStepIndex !== 0, showFinishButton: currentStepIndex + 1 === totalStepCount, taskLocalStepIndex: localIndex, totalLocalSteps: task.steps.length, nextButtonEnabled: nextHotspotIsAvailable, onNextButtonClick: openNextStep, onFinish: onFinish, previousButtonEnabled: previousHotspotIsAvailable, onPreviousButtonClick: openPreviousStep, onDismiss: onDismiss }));\n    }, [\n        id2index,\n        currentTutorial,\n        task,\n        step,\n        open,\n        currentId,\n        currentStepIndex,\n        i18nStrings,\n        taskIndex,\n        localIndex,\n        totalStepCount,\n        nextHotspotIsAvailable,\n        openNextStep,\n        onFinish,\n        previousHotspotIsAvailable,\n        openPreviousStep,\n        onDismiss,\n        onOpen,\n    ]);\n    var registerHotspot = useCallback(function (id) {\n        var _a;\n        if (!id2index || id2index[id] === undefined) {\n            return;\n        }\n        availableHotspotsRef.current = __assign(__assign({}, availableHotspotsRef.current), (_a = {}, _a[id] = true, _a));\n        setAvailableHotspots(function (availableHotspots) {\n            var _a;\n            if (availableHotspots[id]) {\n                return availableHotspots;\n            }\n            return __assign(__assign({}, availableHotspots), (_a = {}, _a[id] = true, _a));\n        });\n    }, [id2index]);\n    var unregisterHotspot = useCallback(function (id) {\n        if (!availableHotspotsRef.current[id]) {\n            return;\n        }\n        availableHotspotsRef.current = removeKey(id, availableHotspotsRef.current);\n        setAvailableHotspots(function (availableHotspots) {\n            if (!availableHotspots[id]) {\n                return availableHotspots;\n            }\n            return removeKey(id, availableHotspots);\n        });\n    }, []);\n    var context = {\n        getContentForId: getContentForId,\n        registerHotspot: registerHotspot,\n        unregisterHotspot: unregisterHotspot,\n        onStartTutorial: onStartTutorial,\n        onExitTutorial: onExitTutorial,\n        currentStepIndex: currentStepIndex,\n        currentTutorial: currentTutorial\n    };\n    return React.createElement(hotspotContext.Provider, { value: context }, children);\n}\napplyDisplayName(AnnotationContext, 'AnnotationContext');\nfunction removeKey(key, object) {\n    var _a = object, _b = key, _ = _a[_b], remainingObject = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n    return remainingObject;\n}\n"]},"metadata":{},"sourceType":"module"}