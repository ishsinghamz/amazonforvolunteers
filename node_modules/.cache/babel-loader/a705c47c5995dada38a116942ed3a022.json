{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { useCallback, useMemo, useState } from 'react';\nimport { KeyCode } from '../../internal/keycode';\nimport { findNavigableSeries, nextValidDomainIndex } from '../utils';\nexport function useNavigation(_a) {\n  var series = _a.series,\n      visibleSeries = _a.visibleSeries,\n      scaledSeries = _a.scaledSeries,\n      barGroups = _a.barGroups,\n      xScale = _a.xScale,\n      yScale = _a.yScale,\n      highlightedPoint = _a.highlightedPoint,\n      highlightedGroupIndex = _a.highlightedGroupIndex,\n      highlightedSeries = _a.highlightedSeries,\n      legendSeries = _a.legendSeries,\n      isHandlersDisabled = _a.isHandlersDisabled,\n      pinPopover = _a.pinPopover,\n      highlightSeries = _a.highlightSeries,\n      highlightGroup = _a.highlightGroup,\n      highlightPoint = _a.highlightPoint;\n\n  var _b = useState(null),\n      targetX = _b[0],\n      setTargetX = _b[1];\n\n  var isGroupNavigation = visibleSeries.some(function (_a) {\n    var series = _a.series;\n    return series.type === 'bar';\n  });\n  var navigableSeries = useMemo(function () {\n    return findNavigableSeries(visibleSeries);\n  }, [visibleSeries]).navigableSeries;\n\n  var onBarGroupFocus = function () {\n    var groupIndex = highlightedGroupIndex !== null && highlightedGroupIndex !== void 0 ? highlightedGroupIndex : 0;\n    setTargetX(xScale.domain[groupIndex]);\n    highlightGroup(groupIndex);\n  };\n\n  var onLineGroupFocus = function () {\n    var _a, _b, _c;\n\n    if (!highlightedSeries || !highlightedPoint) {\n      var targetSeries = (_c = (_a = highlightedSeries !== null && highlightedSeries !== void 0 ? highlightedSeries : legendSeries) !== null && _a !== void 0 ? _a : (_b = series[0]) === null || _b === void 0 ? void 0 : _b.series) !== null && _c !== void 0 ? _c : null;\n      highlightSeries(targetSeries);\n\n      for (var _i = 0, scaledSeries_1 = scaledSeries; _i < scaledSeries_1.length; _i++) {\n        var scaledS = scaledSeries_1[_i];\n\n        if (scaledS.series === targetSeries) {\n          highlightPoint(scaledS);\n          return;\n        }\n      }\n    }\n  };\n\n  var onFocus = function () {\n    if (isGroupNavigation) {\n      onBarGroupFocus();\n    } else {\n      onLineGroupFocus();\n    }\n  };\n\n  var moveBetweenSeries = useCallback(function (direction) {\n    var _a, _b, _c;\n\n    if (isGroupNavigation) {\n      return;\n    }\n\n    var xOffset = xScale.isCategorical() ? Math.max(0, xScale.d3Scale.bandwidth() - 1) / 2 : 0;\n    var MAX_SERIES_INDEX = navigableSeries.length - 1;\n    var previousSeriesIndex = -1;\n\n    if (highlightedSeries) {\n      previousSeriesIndex = navigableSeries.indexOf(highlightedSeries);\n    }\n\n    var nextSeriesIndex = 0;\n\n    if (previousSeriesIndex !== -1) {\n      nextSeriesIndex = previousSeriesIndex + direction;\n\n      if (nextSeriesIndex > MAX_SERIES_INDEX) {\n        nextSeriesIndex = 0;\n      } else if (nextSeriesIndex < 0) {\n        nextSeriesIndex = MAX_SERIES_INDEX;\n      }\n    }\n\n    var nextSeries = navigableSeries[nextSeriesIndex];\n    var nextInternalSeries = series.filter(function (_a) {\n      var series = _a.series;\n      return series === nextSeries;\n    })[0];\n    var targetXPoint = ((_a = xScale.d3Scale(targetX)) !== null && _a !== void 0 ? _a : NaN) + xOffset;\n\n    if (!isFinite(targetXPoint)) {\n      targetXPoint = 0;\n    }\n\n    if (nextSeries.type === 'line') {\n      var nextSeriesData = nextSeries.data;\n      var lookingForScaled_1 = targetXPoint;\n      var nextPoint = nextSeriesData.map(function (d) {\n        return {\n          x: (xScale.d3Scale(d.x) || 0) + xOffset,\n          y: yScale.d3Scale(d.y) || 0,\n          datum: d\n        };\n      }).reduce(function (prev, curr) {\n        return Math.abs(curr.x - lookingForScaled_1) < Math.abs(prev.x - lookingForScaled_1) ? curr : prev;\n      }, {\n        x: -Infinity,\n        y: -Infinity\n      });\n      highlightSeries(nextSeries);\n      highlightPoint(__assign(__assign({}, nextPoint), {\n        color: nextInternalSeries.color,\n        series: nextSeries\n      }));\n    } else if (nextSeries.type === 'threshold') {\n      var scaledTargetIndex = scaledSeries.map(function (it) {\n        var _a;\n\n        return ((_a = it.datum) === null || _a === void 0 ? void 0 : _a.x) || null;\n      }).indexOf(targetX);\n      highlightSeries(nextSeries);\n      highlightPoint({\n        x: targetXPoint,\n        y: (_b = yScale.d3Scale(nextSeries.y)) !== null && _b !== void 0 ? _b : NaN,\n        color: nextInternalSeries.color,\n        series: nextSeries,\n        datum: (_c = scaledSeries[scaledTargetIndex]) === null || _c === void 0 ? void 0 : _c.datum\n      });\n    }\n  }, [isGroupNavigation, xScale, navigableSeries, highlightedSeries, scaledSeries, series, targetX, highlightSeries, highlightPoint, yScale]);\n  var moveWithinSeries = useCallback(function (direction) {\n    var _a;\n\n    var series = highlightedSeries || visibleSeries[0].series;\n    var previousPoint = highlightedPoint || scaledSeries[0];\n\n    if (series.type === 'line') {\n      var indexOfPreviousPoint = (previousPoint === null || previousPoint === void 0 ? void 0 : previousPoint.datum) ? series.data.indexOf(previousPoint.datum) : 0;\n      var nextPointIndex = circleIndex(indexOfPreviousPoint + direction, [0, series.data.length - 1]);\n      var nextPoint_1 = series.data[nextPointIndex];\n      var nextPointScaled = scaledSeries.filter(function (s) {\n        return s.datum === nextPoint_1;\n      })[0] || null;\n      setTargetX(nextPoint_1.x);\n      highlightSeries(series);\n      highlightPoint(nextPointScaled);\n    } else if (series.type === 'threshold') {\n      var scaledThresholdSeries = scaledSeries.filter(function (it) {\n        return it.series === series;\n      })[0];\n      var scaledDataSeries = scaledSeries.filter(function (it) {\n        return it.datum;\n      });\n      var indexOfPreviousPoint = scaledDataSeries.map(function (it) {\n        return it.x;\n      }).indexOf(previousPoint.x);\n      var nextPointIndex = circleIndex(indexOfPreviousPoint + direction, [0, scaledDataSeries.length - 1]);\n      setTargetX(((_a = scaledDataSeries[nextPointIndex].datum) === null || _a === void 0 ? void 0 : _a.x) || null);\n      highlightSeries(series);\n      highlightPoint(__assign(__assign({}, scaledThresholdSeries), {\n        datum: scaledDataSeries[nextPointIndex].datum,\n        x: scaledDataSeries[nextPointIndex].x\n      }));\n    } else if (series.type === 'bar') {\n      var xDomain = xScale.domain;\n      var MAX_GROUP_INDEX = xDomain.length - 1;\n      var nextGroupIndex = 0;\n\n      if (highlightedGroupIndex !== null) {\n        nextGroupIndex = highlightedGroupIndex + direction;\n\n        if (nextGroupIndex > MAX_GROUP_INDEX) {\n          nextGroupIndex = 0;\n        } else if (nextGroupIndex < 0) {\n          nextGroupIndex = MAX_GROUP_INDEX;\n        }\n      }\n\n      var nextDomainIndex = nextValidDomainIndex(nextGroupIndex, barGroups, direction);\n      setTargetX(xDomain[nextDomainIndex]);\n      highlightGroup(nextDomainIndex);\n    }\n  }, [highlightedSeries, visibleSeries, highlightedPoint, scaledSeries, highlightSeries, highlightPoint, xScale.domain, highlightedGroupIndex, barGroups, highlightGroup]);\n  var onKeyDown = useCallback(function (event) {\n    var keyCode = event.keyCode;\n\n    if (keyCode !== KeyCode.up && keyCode !== KeyCode.right && keyCode !== KeyCode.down && keyCode !== KeyCode.left && keyCode !== KeyCode.space && keyCode !== KeyCode.enter) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (isHandlersDisabled) {\n      return;\n    }\n\n    if (keyCode === KeyCode.down || keyCode === KeyCode.up) {\n      moveBetweenSeries(keyCode === KeyCode.down ? 1 : -1);\n    } else if (keyCode === KeyCode.left || keyCode === KeyCode.right) {\n      moveWithinSeries(keyCode === KeyCode.right ? 1 : -1);\n    } else if (keyCode === KeyCode.enter || keyCode === KeyCode.space) {\n      pinPopover();\n    }\n  }, [moveWithinSeries, moveBetweenSeries, isHandlersDisabled, pinPopover]);\n  return {\n    isGroupNavigation: isGroupNavigation,\n    onFocus: onFocus,\n    onKeyDown: onKeyDown\n  };\n}\n\nfunction circleIndex(index, _a) {\n  var from = _a[0],\n      to = _a[1];\n\n  if (index < from) {\n    return to;\n  }\n\n  if (index > to) {\n    return from;\n  }\n\n  return index;\n}","map":{"version":3,"sources":["/Users/isingheg/Desktop/projects/amazonforvolunteers-ui/node_modules/@awsui/components-react/mixed-line-bar-chart/hooks/use-navigation.js"],"names":["__assign","useCallback","useMemo","useState","KeyCode","findNavigableSeries","nextValidDomainIndex","useNavigation","_a","series","visibleSeries","scaledSeries","barGroups","xScale","yScale","highlightedPoint","highlightedGroupIndex","highlightedSeries","legendSeries","isHandlersDisabled","pinPopover","highlightSeries","highlightGroup","highlightPoint","_b","targetX","setTargetX","isGroupNavigation","some","type","navigableSeries","onBarGroupFocus","groupIndex","domain","onLineGroupFocus","_c","targetSeries","_i","scaledSeries_1","length","scaledS","onFocus","moveBetweenSeries","direction","xOffset","isCategorical","Math","max","d3Scale","bandwidth","MAX_SERIES_INDEX","previousSeriesIndex","indexOf","nextSeriesIndex","nextSeries","nextInternalSeries","filter","targetXPoint","NaN","isFinite","nextSeriesData","data","lookingForScaled_1","nextPoint","map","d","x","y","datum","reduce","prev","curr","abs","Infinity","color","scaledTargetIndex","it","moveWithinSeries","previousPoint","indexOfPreviousPoint","nextPointIndex","circleIndex","nextPoint_1","nextPointScaled","s","scaledThresholdSeries","scaledDataSeries","xDomain","MAX_GROUP_INDEX","nextGroupIndex","nextDomainIndex","onKeyDown","event","keyCode","up","right","down","left","space","enter","preventDefault","index","from","to"],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\nimport { useCallback, useMemo, useState } from 'react';\nimport { KeyCode } from '../../internal/keycode';\nimport { findNavigableSeries, nextValidDomainIndex } from '../utils';\nexport function useNavigation(_a) {\n    var series = _a.series, visibleSeries = _a.visibleSeries, scaledSeries = _a.scaledSeries, barGroups = _a.barGroups, xScale = _a.xScale, yScale = _a.yScale, highlightedPoint = _a.highlightedPoint, highlightedGroupIndex = _a.highlightedGroupIndex, highlightedSeries = _a.highlightedSeries, legendSeries = _a.legendSeries, isHandlersDisabled = _a.isHandlersDisabled, pinPopover = _a.pinPopover, highlightSeries = _a.highlightSeries, highlightGroup = _a.highlightGroup, highlightPoint = _a.highlightPoint;\n    var _b = useState(null), targetX = _b[0], setTargetX = _b[1];\n    var isGroupNavigation = visibleSeries.some(function (_a) {\n        var series = _a.series;\n        return series.type === 'bar';\n    });\n    var navigableSeries = useMemo(function () { return findNavigableSeries(visibleSeries); }, [visibleSeries]).navigableSeries;\n    var onBarGroupFocus = function () {\n        var groupIndex = highlightedGroupIndex !== null && highlightedGroupIndex !== void 0 ? highlightedGroupIndex : 0;\n        setTargetX(xScale.domain[groupIndex]);\n        highlightGroup(groupIndex);\n    };\n    var onLineGroupFocus = function () {\n        var _a, _b, _c;\n        if (!highlightedSeries || !highlightedPoint) {\n            var targetSeries = (_c = (_a = highlightedSeries !== null && highlightedSeries !== void 0 ? highlightedSeries : legendSeries) !== null && _a !== void 0 ? _a : (_b = series[0]) === null || _b === void 0 ? void 0 : _b.series) !== null && _c !== void 0 ? _c : null;\n            highlightSeries(targetSeries);\n            for (var _i = 0, scaledSeries_1 = scaledSeries; _i < scaledSeries_1.length; _i++) {\n                var scaledS = scaledSeries_1[_i];\n                if (scaledS.series === targetSeries) {\n                    highlightPoint(scaledS);\n                    return;\n                }\n            }\n        }\n    };\n    var onFocus = function () {\n        if (isGroupNavigation) {\n            onBarGroupFocus();\n        }\n        else {\n            onLineGroupFocus();\n        }\n    };\n    var moveBetweenSeries = useCallback(function (direction) {\n        var _a, _b, _c;\n        if (isGroupNavigation) {\n            return;\n        }\n        var xOffset = xScale.isCategorical() ? Math.max(0, xScale.d3Scale.bandwidth() - 1) / 2 : 0;\n        var MAX_SERIES_INDEX = navigableSeries.length - 1;\n        var previousSeriesIndex = -1;\n        if (highlightedSeries) {\n            previousSeriesIndex = navigableSeries.indexOf(highlightedSeries);\n        }\n        var nextSeriesIndex = 0;\n        if (previousSeriesIndex !== -1) {\n            nextSeriesIndex = previousSeriesIndex + direction;\n            if (nextSeriesIndex > MAX_SERIES_INDEX) {\n                nextSeriesIndex = 0;\n            }\n            else if (nextSeriesIndex < 0) {\n                nextSeriesIndex = MAX_SERIES_INDEX;\n            }\n        }\n        var nextSeries = navigableSeries[nextSeriesIndex];\n        var nextInternalSeries = series.filter(function (_a) {\n            var series = _a.series;\n            return series === nextSeries;\n        })[0];\n        var targetXPoint = ((_a = xScale.d3Scale(targetX)) !== null && _a !== void 0 ? _a : NaN) + xOffset;\n        if (!isFinite(targetXPoint)) {\n            targetXPoint = 0;\n        }\n        if (nextSeries.type === 'line') {\n            var nextSeriesData = nextSeries.data;\n            var lookingForScaled_1 = targetXPoint;\n            var nextPoint = nextSeriesData\n                .map(function (d) { return ({\n                x: (xScale.d3Scale(d.x) || 0) + xOffset,\n                y: yScale.d3Scale(d.y) || 0,\n                datum: d\n            }); })\n                .reduce(function (prev, curr) { return (Math.abs(curr.x - lookingForScaled_1) < Math.abs(prev.x - lookingForScaled_1) ? curr : prev); }, { x: -Infinity, y: -Infinity });\n            highlightSeries(nextSeries);\n            highlightPoint(__assign(__assign({}, nextPoint), { color: nextInternalSeries.color, series: nextSeries }));\n        }\n        else if (nextSeries.type === 'threshold') {\n            var scaledTargetIndex = scaledSeries.map(function (it) { var _a; return ((_a = it.datum) === null || _a === void 0 ? void 0 : _a.x) || null; }).indexOf(targetX);\n            highlightSeries(nextSeries);\n            highlightPoint({\n                x: targetXPoint,\n                y: (_b = yScale.d3Scale(nextSeries.y)) !== null && _b !== void 0 ? _b : NaN,\n                color: nextInternalSeries.color,\n                series: nextSeries,\n                datum: (_c = scaledSeries[scaledTargetIndex]) === null || _c === void 0 ? void 0 : _c.datum\n            });\n        }\n    }, [\n        isGroupNavigation,\n        xScale,\n        navigableSeries,\n        highlightedSeries,\n        scaledSeries,\n        series,\n        targetX,\n        highlightSeries,\n        highlightPoint,\n        yScale,\n    ]);\n    var moveWithinSeries = useCallback(function (direction) {\n        var _a;\n        var series = highlightedSeries || visibleSeries[0].series;\n        var previousPoint = highlightedPoint || scaledSeries[0];\n        if (series.type === 'line') {\n            var indexOfPreviousPoint = (previousPoint === null || previousPoint === void 0 ? void 0 : previousPoint.datum)\n                ? series.data.indexOf(previousPoint.datum)\n                : 0;\n            var nextPointIndex = circleIndex(indexOfPreviousPoint + direction, [0, series.data.length - 1]);\n            var nextPoint_1 = series.data[nextPointIndex];\n            var nextPointScaled = scaledSeries.filter(function (s) { return s.datum === nextPoint_1; })[0] || null;\n            setTargetX(nextPoint_1.x);\n            highlightSeries(series);\n            highlightPoint(nextPointScaled);\n        }\n        else if (series.type === 'threshold') {\n            var scaledThresholdSeries = scaledSeries.filter(function (it) { return it.series === series; })[0];\n            var scaledDataSeries = scaledSeries.filter(function (it) { return it.datum; });\n            var indexOfPreviousPoint = scaledDataSeries.map(function (it) { return it.x; }).indexOf(previousPoint.x);\n            var nextPointIndex = circleIndex(indexOfPreviousPoint + direction, [0, scaledDataSeries.length - 1]);\n            setTargetX(((_a = scaledDataSeries[nextPointIndex].datum) === null || _a === void 0 ? void 0 : _a.x) || null);\n            highlightSeries(series);\n            highlightPoint(__assign(__assign({}, scaledThresholdSeries), { datum: scaledDataSeries[nextPointIndex].datum, x: scaledDataSeries[nextPointIndex].x }));\n        }\n        else if (series.type === 'bar') {\n            var xDomain = xScale.domain;\n            var MAX_GROUP_INDEX = xDomain.length - 1;\n            var nextGroupIndex = 0;\n            if (highlightedGroupIndex !== null) {\n                nextGroupIndex = highlightedGroupIndex + direction;\n                if (nextGroupIndex > MAX_GROUP_INDEX) {\n                    nextGroupIndex = 0;\n                }\n                else if (nextGroupIndex < 0) {\n                    nextGroupIndex = MAX_GROUP_INDEX;\n                }\n            }\n            var nextDomainIndex = nextValidDomainIndex(nextGroupIndex, barGroups, direction);\n            setTargetX(xDomain[nextDomainIndex]);\n            highlightGroup(nextDomainIndex);\n        }\n    }, [\n        highlightedSeries,\n        visibleSeries,\n        highlightedPoint,\n        scaledSeries,\n        highlightSeries,\n        highlightPoint,\n        xScale.domain,\n        highlightedGroupIndex,\n        barGroups,\n        highlightGroup,\n    ]);\n    var onKeyDown = useCallback(function (event) {\n        var keyCode = event.keyCode;\n        if (keyCode !== KeyCode.up &&\n            keyCode !== KeyCode.right &&\n            keyCode !== KeyCode.down &&\n            keyCode !== KeyCode.left &&\n            keyCode !== KeyCode.space &&\n            keyCode !== KeyCode.enter) {\n            return;\n        }\n        event.preventDefault();\n        if (isHandlersDisabled) {\n            return;\n        }\n        if (keyCode === KeyCode.down || keyCode === KeyCode.up) {\n            moveBetweenSeries(keyCode === KeyCode.down ? 1 : -1);\n        }\n        else if (keyCode === KeyCode.left || keyCode === KeyCode.right) {\n            moveWithinSeries(keyCode === KeyCode.right ? 1 : -1);\n        }\n        else if (keyCode === KeyCode.enter || keyCode === KeyCode.space) {\n            pinPopover();\n        }\n    }, [moveWithinSeries, moveBetweenSeries, isHandlersDisabled, pinPopover]);\n    return { isGroupNavigation: isGroupNavigation, onFocus: onFocus, onKeyDown: onKeyDown };\n}\nfunction circleIndex(index, _a) {\n    var from = _a[0], to = _a[1];\n    if (index < from) {\n        return to;\n    }\n    if (index > to) {\n        return from;\n    }\n    return index;\n}\n"]},"metadata":{},"sourceType":"module"}