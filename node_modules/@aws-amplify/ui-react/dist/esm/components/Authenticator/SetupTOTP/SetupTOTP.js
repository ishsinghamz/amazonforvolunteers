import{__awaiter as e}from"../../../node_modules/tslib/tslib.es6.js";import{jsx as t,jsxs as o}from"react/jsx-runtime";import i from"qrcode";import*as r from"react";import{Logger as s,Auth as a}from"aws-amplify";import{getActorState as n,translate as l}from"@aws-amplify/ui";import{Flex as d}from"../../../primitives/Flex/Flex.js";import{Heading as m}from"../../../primitives/Heading/Heading.js";import{useAuthenticator as p}from"../hooks/useAuthenticator/index.js";import{useCustomComponents as c}from"../hooks/useCustomComponents/index.js";import{useFormHandlers as u}from"../hooks/useFormHandlers/useFormHandlers.js";import{ConfirmSignInFooter as f}from"../shared/ConfirmSignInFooter.js";import{RemoteErrorMessage as h}from"../shared/RemoteErrorMessage.js";import{FormFields as g}from"../shared/FormFields.js";const v=new s("SetupTOTP-logger"),j=()=>{var s,m;const{_state:y,isPending:O}=p((e=>[e.isPending])),{handleChange:H,handleSubmit:b}=u(),{components:{SetupTOTP:{Header:x=j.Header,Footer:C=j.Footer}}}=c(),[T,w]=r.useState(!0),[F,S]=r.useState(),[P,V]=r.useState("COPY"),[k,L]=r.useState(""),M=n(y),{user:$}=M.context,q=null===(m=null===(s=n(y).context)||void 0===s?void 0:s.formFields)||void 0===m?void 0:m.setupTOTP,D=null==q?void 0:q.QR;r.useEffect((()=>{$&&(t=>{e(void 0,void 0,void 0,(function*(){var e,o;try{const r=yield a.setupTOTP(t);L(r);const s=null!==(e=null==D?void 0:D.totpIssuer)&&void 0!==e?e:"AWSCognito",n=`otpauth://totp/${s}:${null!==(o=null==D?void 0:D.totpUsername)&&void 0!==o?o:t.username}?secret=${r}&issuer=${s}`,l=yield i.toDataURL(n);S(l)}catch(e){v.error(e)}finally{w(!1)}}))})($)}),[$]);return t("form",Object.assign({"data-amplify-form":"","data-amplify-authenticator-setup-totp":"",method:"post",onChange:H,onSubmit:b},{children:o("fieldset",Object.assign({style:{display:"flex",flexDirection:"column"},className:"amplify-flex",disabled:O},{children:[t(x,{}),o(d,Object.assign({direction:"column"},{children:[T?o("p",{children:[l("Loading"),"â€¦"]}):t("img",{"data-amplify-qrcode":!0,src:F,alt:"qr code",width:"228",height:"228"}),o(d,Object.assign({"data-amplify-copy":!0},{children:[t("div",{children:k}),o(d,Object.assign({"data-amplify-copy-svg":!0,onClick:()=>{navigator.clipboard.writeText(k),V(l("COPIED"))}},{children:[t("div",Object.assign({"data-amplify-copy-tooltip":!0},{children:P})),t("svg",Object.assign({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},{children:t("path",{d:"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z"})}))]}))]})),t(g,{route:"setupTOTP"}),t(h,{})]})),t(f,{}),t(C,{})]}))}))};j.Header=()=>t(m,Object.assign({level:3},{children:l("Setup TOTP")})),j.Footer=()=>null;export{j as SetupTOTP};
